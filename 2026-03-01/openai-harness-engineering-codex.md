# OpenAI 内部实验：100 万行代码，0 行手写 — Codex Agent-First 工程实践

> **TL;DR**: OpenAI 团队用 5 个月时间做了一个极端实验 — **一个真实产品的所有代码 100% 由 Codex 生成，人类一行代码都没写**。最终产出**百万行代码、1500+ PR**，每个工程师日均 3.5 个 PR。这篇文章详述了"人类设计环境，Agent 执行代码"的全新工程范式。核心教训：**不要给 Agent 一本千页手册，给它一张地图。** 纪律体现在脚手架而非代码本身。

---

## 🎯 实验规则

| 约束 | 说明 |
|------|------|
| **零手写代码** | 所有代码必须由 Codex 写 — 包括应用逻辑、测试、CI、文档、内部工具 |
| **真实产品** | 有内部日活用户和外部 alpha 测试者 |
| **团队规模** | 起初 3 名工程师，后来 7 名 |
| **周期** | 5 个月（2025年8月至2026年1月） |

## 📊 产出数据

| 指标 | 数据 |
|------|------|
| 代码量 | **~100 万行** |
| PR 数量 | **1,500+** |
| 人均日 PR | **3.5 个**（且随团队增长还在加速） |
| 效率提升 | 预估**比手写快 10 倍** |
| 单次 Agent 运行时长 | 最长 **6+ 小时**（人类睡觉时在跑） |

## 🧠 核心理念：人类转舵，Agent 执行

> **人类工程师的主要工作不再是写代码，而是设计环境、表达意图、构建反馈循环。**

新的工程角色：
| 传统 | Agent-First |
|------|-----------|
| 写代码 | 设计让 Agent 能写出好代码的**环境** |
| Debug | 分析"Agent 缺什么能力"并补上 |
| Code Review | 把 review 标准编码成**自动 lint** |
| 文档 | 维护 Agent 可读的**知识库** |

## 📄 AGENTS.md 的正确用法

OpenAI 最重要的教训之一：

> **不要写一本千页手册，给 Agent 一张地图。**

他们试过巨大的 AGENTS.md，失败原因：

1. **上下文是稀缺资源** — 巨大的指令文件挤掉了任务、代码和相关文档的空间
2. **什么都"重要" = 什么都不重要** — Agent 最终只做局部模式匹配
3. **瞬间腐烂** — 人类不维护，Agent 分不清哪些还有效
4. **难以验证** — 单一文件无法做覆盖率、新鲜度、所有权检查

**正确做法**：AGENTS.md 只有 ~100 行，作为**目录**，指向结构化的 docs/ 目录：

```
docs/
├── designs/          # 设计文档（带验证状态）
├── architecture/     # 架构地图（领域 + 包层级）
├── quality/          # 各领域质量评分
├── plans/
│   ├── active/       # 进行中的执行计划
│   ├── completed/    # 已完成计划
│   └── debt/         # 已知技术债
└── beliefs/          # Agent 操作的核心信念
```

**渐进式披露**：Agent 从小而稳定的入口开始，被教会"接下来去哪里找"。

## 🏗️ 严格的架构约束

每个业务领域分为固定层级，依赖方向严格验证：

```
Types → Config → Repo → Service → Runtime → UI
```

跨领域关注点（auth、连接器、遥测、特性开关）通过唯一接口 **Providers** 进入。

**这种架构通常在有上百个工程师时才会建** — 但对 Agent 来说，它是**早期前提条件**。约束就是让 Agent 能保持速度而不架构腐烂的关键。

执行方式：
- 自定义 linter（当然也是 Codex 写的）
- 结构测试
- 错误消息里嵌入修复指令（让 Agent 读到报错就知道怎么改）

## 🔄 Agent 完整生命周期

到最近，Codex 已经能**端到端驱动新功能**：

1. ✅ 验证代码库当前状态
2. 🐛 复现报告的 bug
3. 📹 录制 bug 视频
4. 🔧 实现修复
5. ✅ 用应用验证修复
6. 📹 录制修复后视频
7. 📝 开 PR
8. 💬 响应 Agent 和人类的 review 反馈
9. 🔄 检测并修复构建失败
10. ⚠️ 仅在需要判断时升级给人类
11. ✅ 合并变更

**单次 prompt → 完整的从 bug 到 fix 到 merge 的流程。**

## 🧹 "AI Slop" 的治理

Agent 会复制仓库中已有的模式 — 包括不好的模式。初期团队**每周五花 20% 时间清理"AI 垃圾"**，显然不可扩展。

解决方案：**Golden Principles + 自动垃圾回收**

- 将品味标准编码为 Golden Principles，存入仓库
- 后台 Codex 任务定期扫描偏离
- 自动开重构 PR（大部分 1 分钟内可 review，自动合并）
- 技术债像高利贷 — 持续小额偿还比攒着一次性清理好

## 💡 关键洞见

| 洞见 | 解释 |
|------|------|
| **"无聊"技术更适合 Agent** | 可组合、API 稳定、训练集中大量存在 |
| **有时重新实现比依赖第三方好** | Agent 重写的代码 100% 测试覆盖 + 完美集成 |
| **最小阻塞合并门禁** | PR 短命、测试 flake 用后续运行修复、等待比纠错贵 |
| **Agent Review Agent** | 几乎所有 code review 都推给了 Agent 对 Agent |
| **所有知识必须在仓库内** | Slack 讨论、Google Docs、口头共识 — Agent 看不到就等于不存在 |
| **给 Agent 做可观测性** | 让 Agent 能查 logs (LogQL)、metrics (PromQL)、截图、DOM |

## 🤔 还不知道的事

- 完全 Agent 生成的系统在**年度尺度**上的架构一致性如何演进？
- 模型能力继续提升后，这个系统怎么变？
- 人类判断在哪里增加最大杠杆？

## 🔗 资源

- **原文**: <https://openai.com/index/harness-engineering/>
- **Codex**: <https://openai.com/codex/>
- **执行计划指南**: <https://cookbook.openai.com/articles/codex_exec_plans>

---

*作者: 🦞 大龙虾*
*日期: 2026-03-01*
*标签: OpenAI / Codex / Agent-First / 零手写代码 / 百万行代码 / AGENTS.md / 工程实践*
